angular.module("edify.allskills",[]).controller("AllSkillsController",["$scope","Auth","Skills",function(a,b,c){a.allSkills=[],a.sort="-learners",a.getProfile=function(){b.isAuth()?a.user=b.user():b.getUser().then(function(b){a.user=b.data})},a.getProfile(),a.getAllSkills=function(){c.getAllSkills().then(function(b){var c={};for(var d in b)c.skill_name=d,c.learners=b[d].learners,c.teachers=b[d].teachers,c.skill_id=b[d].skill_id,c.skill_description=b[d].skill_description,a.allSkills.push(c),c={};console.log("allSkills",a.allSkills)})["catch"](function(a){console.error(a)})},a.getAllSkills(),a.setSort=function(b){a.sort=b},a.addLearnSkill=function(b){var d={type:"learn",skill:b,skillLevel:1,userId:a.user.id};c.postSkill(d).then(function(a){console.log("added skill to learn!")})},a.addTeachSkill=function(b){var d={type:"teach",skill:b,skillLevel:1,userId:a.user.id};c.postSkill(d).then(function(a){console.log("added skill to teach!")})}}]),angular.module("edify.allusers",[]).controller("AllUsersController",["$scope","Auth","Users",function(a,b,c){a.allUsers=[],a.sort="-learners",a.getProfile=function(){b.isAuth()?a.user=b.user():b.getUser().then(function(b){a.user=b.data})},a.getProfile(),a.getAllUsers=function(){c.getAllUsers().then(function(b){console.log(b);a.allUsers=b})["catch"](function(a){console.error(a)})},a.getAllUsers(),a.setSort=function(b){a.sort=b}}]),angular.module("edify.user",["ui.router"]).controller("UserController",["$scope","$stateParams","$state","Users","Auth","Level",function(a,b,c,d,e,f){a.user=null,a.getUser=function(){d.getUser(b.username).then(function(b){a.user=b})["catch"](function(a){console.error(a)})},a.getUser(),a.levelToWord=function(a){return f.toWord(a)},a.getVoter=function(){return e.user()}}]),angular.module("edify.main",[]).controller("MainController",["$rootScope","$scope","$modal","Auth","Users","Skills","Level",function(a,b,c,d,e,f,g){d.getUser().success(function(a,c){b.user=a}).error(function(a,b){console.log("ERROR:",b)});var h=function(){b.user=d.user()};a.$on("skillChange",h),b.levelToWord=function(a){return g.toWord(a)},b.maxLevel=g.max,b.updateUser=function(){var a={blurb:b.user.blurb,userId:b.user.id};console.log(a),e.putUser(a).then(function(a){console.log("saved user data!")})},b.increaseLearnSkillLevel=function(a){b.user.learnSkills[a].skill_level+=1},b.decreaseLearnSkillLevel=function(a){b.user.learnSkills[a].skill_level-=1},b.saveLearnSkill=function(a){b.saving=!0;var c={type:"learn",skill:b.user.learnSkills[a].skill_name,skillLevel:b.user.learnSkills[a].skill_level,userId:b.user.id,blurb:b.user.learnSkills[a].blurb};f.postSkill(c).then(function(a){console.log("learn skill saved!"),b.saving=!1})},b.removeLearnSkill=function(a){var c=b.user.learnSkills[a].id;b.user.learnSkills.splice(a,1),f.deleteSkill(b.user.id,c,"learn").then(function(a){console.log(a)})},b.increaseTeachSkillLevel=function(a){b.user.teachSkills[a].skill_level+=1},b.decreaseTeachSkillLevel=function(a){b.user.teachSkills[a].skill_level-=1},b.saveTeachSkill=function(a){var c={type:"teach",skill:b.user.teachSkills[a].skill_name,skillLevel:b.user.teachSkills[a].skill_level,userId:b.user.id,blurb:b.user.teachSkills[a].blurb};f.postSkill(c).then(function(a){console.log("teach skill saved!")})},b.removeTeachSkill=function(a){var c=b.user.teachSkills[a].id;b.user.teachSkills.splice(a,1),f.deleteSkill(b.user.id,c,"teach").then(function(a){console.log(a)})},b.open=function(a){var e;"learn"===a?e=c.open({animation:!0,templateUrl:"app/templates/modals/learn.html",controller:"learnModalController",size:"lg",resolve:{items:function(){return!0}}}):"teach"===a&&(e=c.open({animation:!0,templateUrl:"app/templates/modals/teach.html",controller:"teachModalController",size:"lg",resolve:{items:function(){return!0}}})),e.result.then(function(){console.log("modal closed!"),d.getUser().success(function(a,c){b.user=a}).error(function(a,b){console.log("ERROR:",b)})})}}]),angular.module("edify.skill",["ui.router"]).controller("SkillController",["$scope","$stateParams","Skills","Auth","Level",function(a,b,c,d,e){a.skillname=b.skillname,a.levelToWord=function(a){return e.toWord(a)},a.getSkill=function(){c.getSkill(b.skillname).then(function(b){a.learners=b.learners,a.teachers=b.teachers,a.skill_id=b.skill_id,a.skill_description=b.skill_description})["catch"](function(a){console.error(a)})},a.getSkill(),a.getProfile=function(){d.isAuth()?a.user=d.user():d.getUser().then(function(b){a.user=b.data})},a.getProfile(),a.addLearnSkill=function(b){var d={type:"learn",skill:b,skillLevel:1,userId:a.user.id};c.postSkill(d).then(function(a){console.log("added skill to learn!")})},a.addTeachSkill=function(b){var d={type:"teach",skill:b,skillLevel:1,userId:a.user.id};c.postSkill(d).then(function(a){console.log("added skill to teach!")})},a.getVoter=function(){return d.user()}}]),angular.module("edify.modal",[]).controller("learnModalController",["$rootScope","$scope","$modalInstance","Auth","Skills","items",function(a,b,c,d,e,f){b.items=f,b.ok=function(){c.close()},b.cancel=function(){c.dismiss("cancel")},b.allSkills=[],b.sort="-learners",b.getProfile=function(){d.isAuth()?b.user=d.user():d.getUser().then(function(a){b.user=a.data})},b.getProfile(),b.getAllSkills=function(){e.getAllSkills().then(function(a){for(var c={},e=d.user().learnSkills,f=[],g=0;g<e.length;g++)f.push(e[g].skill_name);for(var h in a)c.skill_name=h,c.learners=a[h].learners,c.teachers=a[h].teachers,c.skill_id=a[h].skill_id,c.skill_description=a[h].skill_description,-1===f.indexOf(h)&&b.allSkills.push(c),c={}})["catch"](function(a){console.error(a)})},b.getAllSkills(),b.setSort=function(a){b.sort=a},b.addLearnSkill=function(c){for(var f={type:"learn",skill:c,skillLevel:1,userId:b.user.id},g=-1,h=0;h<b.allSkills.length;h++){var i=b.allSkills[h];i.skill_name===c&&(g=h)}-1!==g&&b.allSkills.splice(g,1),e.postSkill(f).then(function(b){console.log("added skill to learn!");var e=d.user(),f={blurb:null,id:b.skill_id,skill_level:1,skill_name:c,stars:null};e.learnSkills.push(f),d.setUser(e),a.$emit("skillChange")})}}]).controller("teachModalController",["$rootScope","$scope","$modalInstance","Auth","Skills","items",function(a,b,c,d,e,f){b.items=f,b.ok=function(){c.close()},b.cancel=function(){c.dismiss("cancel")},b.allSkills=[],b.sort="-learners",b.getProfile=function(){d.isAuth()?b.user=d.user():d.getUser().then(function(a){b.user=a.data})},b.getProfile(),b.getAllSkills=function(){e.getAllSkills().then(function(a){for(var c={},e=d.user().teachSkills,f=[],g=0;g<e.length;g++)f.push(e[g].skill_name);for(var h in a)c.skill_name=h,c.learners=a[h].learners,c.teachers=a[h].teachers,c.skill_id=a[h].skill_id,c.skill_description=a[h].skill_description,-1===f.indexOf(h)&&b.allSkills.push(c),c={}})["catch"](function(a){console.error(a)})},b.getAllSkills(),b.setSort=function(a){b.sort=a},b.addTeachSkill=function(c){for(var f={type:"teach",skill:c,skillLevel:1,userId:b.user.id},g=-1,h=0;h<b.allSkills.length;h++){var i=b.allSkills[h];i.skill_name===c&&(g=h)}-1!==g&&b.allSkills.splice(g,1),e.postSkill(f).then(function(b){console.log("added skill to teach!");var e=d.user(),f={blurb:null,id:b.skill_id,skill_level:1,skill_name:c,stars:null};e.teachSkills.push(f),d.setUser(e),a.$emit("skillChange")})}}]),angular.module("edify.services",[]).factory("Auth",["$http","$location","$window",function(a,b,c){var d=null,e=function(){return a({method:"GET",url:"/api/profile"})},f=function(){return d},g=function(a){d=a},h=function(){return!!d},i=function(){a({method:"GET",url:"/logout"}),d=null,b.path("/signin")};return{user:f,getUser:e,setUser:g,isAuth:h,signOut:i}}]).factory("Users",["$http",function(a){var b=function(b){return a({method:"GET",url:"/api/users/"+b}).then(function(a){return a.data})},c=function(){return a({method:"GET",url:"/api/users/"}).then(function(a){return a.data})},d=function(b){return a({method:"POST",url:"/api/",data:b}).then(function(a){return a.data})},e=function(b){return a({method:"PUT",url:"/api/profile",data:b}).then(function(a){return a.data})};return{getUser:b,postUser:d,putUser:e,getAllUsers:c}}]).factory("Skills",["$http",function(a){var b=function(){return a({method:"GET",url:"/api/skills/"}).then(function(a){return a.data})},c=function(b){return a({method:"GET",url:"/api/skills/"+b}).then(function(a){return a.data})},d=function(b){return a({method:"POST",url:"/api/skills/",data:b}).then(function(a){return a.data})},e=function(b,c,d){return a({method:"POST",url:"/api/skills/delete",data:{type:d,skillId:c,userId:b}}).then(function(a){return a.data})};return{getAllSkills:b,postSkill:d,deleteSkill:e,getSkill:c}}]).factory("Level",function(){var a=["wat","noob","adventurer","enthusiast","practicioner","master","sorcerer"],b=function(b){return a[b]};return{toWord:b,max:a.length-1,min:0}}).directive("starRating",function(){return{restrict:"A",template:'<span class="rating">{{stars.length}}üëç</span>',scope:{ratingValue:"=",max:"="},link:function(a,b,c){a.stars=[];for(var d=0;d<a.max;d++)a.stars.push({filled:d<a.ratingValue})}}}).factory("Likes",["$http",function(a){var b=function(){return a({method:"GET",url:"/api/likeTeachers"}).then(function(a){return a.data})};return{getLikeTeachers:b}}]).directive("upvote",["Likes",function(a){return{restrict:"E",template:'<div><button type="button" class="btn btn-default btn-sm" ng-click="upvoteUser()">/{{actionStatus}}</button>{{message}}</div>',scope:{voter:"=",teacher:"=",learner:"=",skill:"="},link:function(b,c,d){b.message="",b.upvoted=!1,b.actionStatus="Upvote",b.voterLikes={},b.upvoteUser=function(){a.getLikeTeachers().then(function(a){console.log("request to Likes.getLikeTeachers"),b.voterLikes.teachers=a,console.log(b.voterLikes.teachers)}),console.log("voter id:",b.voter.id),console.log("teacher id:",b.teacher),console.log("learner id:",b.learner),console.log("skill:",b.skill),b.upvoted||(b.upvoted=!0,b.message="Thanks for your feedback!",b.actionStatus="üëç")},b.saveUpvote=function(){}}}}]),angular.module("edify.location",[]).factory("Location",["$http","$location","$window","$q",function(a,b,c,d){var e=function(a,b,c){var d=f(a),e=f(b);d.then(function(a){e.then(function(b){var d=i({lat:a.lat(),lng:a.lng()},{lat:b.lat(),lng:b.lng()});c(d)})})},f=function(a){var b=new google.maps.Geocoder,c=d.defer();return b.geocode({address:a.toString()},function(a,b){a.length>1&&c.resolve(0),a[0].geometry.location?c.resolve(a[0].geometry.location):c.resolve(0)}),c.promise},g=function(a){return a*Math.PI/180},h=function(a){return Math.round(1e3*a)/1e3},i=function(a,b){var c,d,e,f,i,j,k,l,m,n=3961;return c=g(1*a.lat),d=g(1*a.lng),e=g(1*b.lat),f=g(1*b.lng),i=e-c,j=f-d,k=Math.pow(Math.sin(i/2),2)+Math.cos(c)*Math.cos(e)*Math.pow(Math.sin(j/2),2),l=2*Math.atan2(Math.sqrt(k),Math.sqrt(1-k)),m=l*n,h(m)};return{calculateDistance:i,byZipCode:f,calculateZipDistance:e}}]),angular.module("edify",["ui.router","ui.bootstrap","monospaced.elastic","edify.modal","edify.services","edify.user","edify.allskills","edify.allusers","edify.main","edify.skill"]).controller("AppController",["$scope","Auth",function(a,b){b.getUser().success(function(b,c){a.user=b}).error(function(a,b){console.log("ERROR:",b)}),a.isSignedIn=function(){return b.isAuth()},a.isSignedOut=function(){return!b.isAuth()}}]).run(["$rootScope","$state","Auth",function(a,b,c){a.$on("$stateChangeStart",function(a,d,e,f,g){if("signin"!==d.name&&"about"!==d.name){var h=c.isAuth();return h?h&&"user"===d.name&&e.username===c.user().username?(a.preventDefault(),void b.go("home")):void 0:void c.getUser().success(function(a,b){console.log("Logged in:",a),c.setUser(a)}).error(function(c,d){console.log("ERROR:",d),a.preventDefault(),b.go("signin")})}})}]).config(["$stateProvider","$urlRouterProvider",function(a,b){b.otherwise("/"),a.state("about",{url:"/about",templateUrl:"app/templates/about.html"}).state("home",{url:"/",templateUrl:"app/templates/main.html",controller:"MainController"}).state("signin",{url:"/signin",templateUrl:"app/templates/signin.html"}).state("signout",{url:"/",controller:["Auth",function(a){a.signOut()}]}).state("user",{url:"/user/:username",templateUrl:"app/templates/user.html",controller:"UserController"}).state("allskills",{url:"/skills",templateUrl:"app/templates/allskills.html",controller:"AllSkillsController"}).state("allusers",{url:"/users",templateUrl:"app/templates/allusers.html",controller:"AllUsersController"}).state("skill",{url:"/skill/:skillname",templateUrl:"app/templates/skill.html",controller:"SkillController"})}]);